<topology>
   <environment id="dev-1" group="development">
      <zone type="dmz">
         <slb id="slb-1">
            <on pool="slb:a" />
            <route public="true">
               <location protocol="http" host="unidal.org" path="/uml" />
               <upstream service="uml" host="unidal.local" path="/uml" />
            </route>
            <route>
               <location protocol="http" host="unidal.org" path="/tulip" />
               <upstream service="tulip" host="unidal.local" path="/tulip" />
            </route>
            <require type="nginx" version="1.21.6" />
         </slb>
         <pool id="slb:a">
            <node id="nginx-1" />
            <node id="nginx-2" />
         </pool>
      </zone>
      <zone type="service">
         <application name="uml">
            <service type="webapp" replicas="2">
               <ingress with="nginx">
                  <path host="uml.unidal.local" path-prefix="/" target="/" />
               </ingress>
               <image name="uml" type="war" from="tomcat:9-jdk17-corretto">
                  <library name="graphbiz" />
                  <volume name="library" type="Directory" from-path="~/.uml" to-path="/root/.uml" />
               </image>
            </service>
         </application>
         <application name="tulip">
            <service type="webapp" namespace="default" replicas="2">
               <ingress type="nginx">
                  <rule host="tulip.unidal.local" path-prefix="/" target="/" />
               </ingress>
               <image name="tulip" type="war" from="tomcat:9-jdk17-corretto">
                  <volume name="config " type="DirectoryOrCreate" from-path="~/.tulip/config" to-path="/root/.tulip" />
               </image>
            </service>
            <service type="mysql" namespace="mysql">
               <image name="amd64/mysql">
                  <env name="MYSQL_DATABASE" value="tulip" />
                  <env name="MYSQL_ROOT_PASSWORD">
                     <secret-key-ref name="mysql-root-password" key="password" />
                  </env>
                  <secret name="mysql-root-password">
                     <data key="password">UGFzc3cwcmQ=</data>
                  </secret>
                  <volume name="tulip-mysql-datadir" type="DirectoryOrCreate" from-path="~/.tulip/data" to-path="/var/lib/mysql" />
                  <volume name="tulip-mysql-script" type="Directory" from-path="~/.tulip/script" to-path="/docker-entrypoint-initdb.d" />
               </image>
            </service>
         </application>
      </zone>
      <zone type="data">
         <storage type="mysql" id="tulip">
            <on pool="mysql:tulip" />
         </storage>
         <storage type="redis" id="tulip">
            <on pool="redis:tulip" />
         </storage>
         <pool id="mysql:tulip">
            <node id="mysql-1" />
            <node id="mysql-2" />
         </pool>
         <pool id="redis:tulip">
            <node id="redis-1" />
            <node id="redis-2" />
            <node id="redis-3" />
         </pool>
      </zone>
      <zone type="mgmt">
         <slb id="slb-2">
            <on pool="slb:b" />
            <route pubilc="true">
               <location protocol="http" host="admin.unidal.org" path="/tulip" />
               <upstream service="tulip" host="unidal.local" path="/tulip" />
            </route>
            <require type="nginx" version="1.21.6" />
         </slb>
         <pool id="slb:b">
            <node id="nginx-1" />
            <node id="nginx-2" />
         </pool>
      </zone>
   </environment>
</topology>